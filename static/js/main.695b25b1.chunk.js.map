{"version":3,"sources":["db/index.ts","Nav/ctx.ts","Nav/index.tsx","db/dao.ts","utils/index.tsx","server/group.ts","server/tag.ts","server/space.ts","Space/index.tsx","Tag/index.tsx","comps/TreeSelector.tsx","Group/index.tsx","TABLE/index.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["TABLE","TYPE","Ctx","createContext","menus","update","Nav","ctx","useContext","react_default","a","createElement","style","borderRight","height","fontWeight","map","x","es","key","to","url","padding","name","replace","storage","window","localStorage","table","getter","t","getItem","JSON","parse","init","Proxy","get","target","p","Reflect","set","v","setItem","stringify","db","add","row","push","del","at","forEach","idx","splice","updater","query","by","find","list","filter","max","Math","apply","concat","Object","toConsumableArray","id","Space","classCallCheck","this","alias","SPACE","Tag","space_id","type","USER","space_alias","TAG","Group","path","is_root","tag_id","children","GROUP","GroupXGroup","group_id","link_group_id","GROUPXGROUP","matcher","cond","item","boolWhenEmpty","arguments","length","undefined","prototype","toString","call","keys","reduce","b","database","dbx","fillGroupBasic","group","g","tag","tags","tag_alias","fillGroupLinks","links","gg","o","linked","has","fillGroup","_","cloneDeep","fillGroupChildren","notSelf","isMatch","startsWith","isMutiple","test","Array","isArray","parent","objectSpread","linking","flutten","arr","k","ls","_query","i","append","aid","r","d","son","dbspace","tt","groups","space","Item","Form","layout","labelCol","span","wrapperCol","List","_useState","useState","_useState2","slicedToArray","setList","_Form$useForm","useForm","form","trigger","useCallback","Api","useEffect","toSubmit","values","console","log","old","message","success","display","flex","es_button","onClick","setFieldsValue","es_table","rowKey","dataSource","columns","dataIndex","title","render","es_form","assign","onFinish","label","required","input","disabled","htmlType","RadioGroup","Radio","params","useParams","match","root","Tag_Item","options","value","ROLE","DATA","RESOURCE","TreeSelector","_ref","onChange","tree","expanded","useRef","node","child","expandedKeys","setExpandedKeys","_useState3","_useState4","autoExpandParent","setAutoExpandParent","current","es_tree","checkable","onExpand","onCheck","checkedKeys","treeData","location","useLocation","_useState5","_useState6","setTree","_useState7","_useState8","setDataSource","parenting","_useState9","_useState10","now","setNow","_useState11","_useState12","up","setUp","resetFields","setTimeout","transfer","es_row","gutter","col","e","stopPropagation","neo","next","isEqual","error","trees","watedTypes","mapper","after","before","showLine","Group_Item","comps_TreeSelector","spaceList","setSpaceList","tagList","setTagList","groupList","setGroupList","xList","setXList","spaces","spacelist","uniqBy","Home","props","es_space","direction","width","size","card","Grid","Boolean","hostname","ReactDOM","setMenus","Nav_ctx","Provider","flexDirection","boxShadow","justifyContent","aria-label","role","href","GithubOutlined","translate","src_Nav","basepath","App_Home","src_Space","src_Tag","src_Group","src_TABLE","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.695b25b1.chunk.js","sourcesContent":["export enum TABLE {\n  SPACE = 'SPACE',\n  TAG = 'TAG',\n  GROUP = 'GROUP',\n  GROUPXGROUP = 'GROUPXGROUP',\n}\n\nexport enum TYPE {\n  USER = 'USER',\n  ROLE = 'ROLE',\n  DATA = 'DATA',\n  RESOURCE = 'RESOURCE',\n}\n\nconst storage = window.localStorage;\n\nconst table = (name: TABLE) => {\n  const getter = () => {\n    const t = storage.getItem(TABLE[name]);\n    return t ? JSON.parse(t) : [];\n  };\n\n  let init = getter();\n  const proxy = new Proxy(init, {\n    get(target, p) {\n      init = getter();\n      return Reflect.get(init, p);\n    },\n    set(target, p, v) {\n      Reflect.set(init, p, v);\n      storage.setItem(TABLE[name], JSON.stringify(init));\n      return true;\n    },\n  });\n\n  return proxy;\n};\n\ntype Selector<T> = (row: T) => boolean;\ntype Updater<T> = (row: T) => T;\n\nconst list = <T>(name: TABLE, by: Selector<T>) => {\n  const t = table(name);\n  return t.filter(by) as T[];\n};\n\nconst query = <T>(name: TABLE, by: Selector<T>) => {\n  const t = table(name);\n  return t.find((row: T) => {\n    if (row) {\n      return by(row);\n    }\n    return false;\n  }) as T | undefined;\n};\n\nconst update = <T>(name: TABLE, at: Selector<T>, updater: Updater<T>) => {\n  const t = table(name);\n  t.forEach((row: T, idx: number) => {\n    if (at(row)) {\n      updater(t[idx]);\n    }\n  });\n  return true;\n};\n\nconst del = <T>(name: TABLE, at: Selector<T>) => {\n  let t = table(name);\n  t.forEach((row: T, idx: number) => {\n    if (at(row)) {\n      t.splice(idx, 1);\n    }\n  });\n  return true;\n};\n\nconst add = <T>(name: TABLE, row: T) => {\n  const t = table(name);\n  t.push(row);\n  return true;\n};\n\nconst db = <T>(name: TABLE) => {\n  return {\n    add: (row: T) => add(name, row),\n    del: (at: Selector<T>) => del(name, at),\n    update: (at: Selector<T>, updater: Updater<T>) => update(name, at, updater),\n    query: (by: Selector<T>) => query(name, by),\n    list: (by: Selector<T>) => list(name, by),\n  };\n};\ndb.TABLE = TABLE;\n\nexport default db as typeof db & {\n  TABLE: TABLE;\n};\n","import { createContext } from 'react';\n\nexport type Menu = {\n  key: string;\n  name: string;\n  url: string;\n};\n\nconst Ctx = createContext<{\n  menus: Menu[];\n  update: () => void;\n}>({\n  menus: [],\n  update: () => {},\n});\n\nexport default Ctx;\n","import React, { FC, useContext } from 'react';\nimport { Link } from '@reach/router';\nimport Ctx from './ctx';\n\nconst menus = {\n  name: 'A SPACE ODYSSEY  🛰',\n  links: [\n    {\n      key: 'HOME',\n      name: 'HOME',\n      url: '/ace',\n    },\n    {\n      key: 'TABLE',\n      name: 'TABLE',\n      url: '/ace/table',\n    },\n    {\n      key: 'SPACE',\n      name: 'SPACE',\n      url: '/ace/space',\n    },\n  ],\n};\n\nconst Nav: FC = () => {\n  const ctx = useContext(Ctx);\n  return (\n    <div style={{ borderRight: '1px solid #ececec', height: '100%' }}>\n      <p style={{ fontWeight: 'bold' }}>{menus.name}</p>\n      {ctx\n        ? ctx.menus.map((x: any) => {\n            return (\n              <Link key={x.key} to={x.url}>\n                <div style={{ padding: '16px' }}>\n                  {x.name.replace('//GROUP', '____').replace('//TAG', '_')}\n                </div>\n              </Link>\n            );\n          })\n        : null}\n    </div>\n  );\n};\n\nexport default Nav;\n","// [\n//   Space[\n//     Group(\n//       Tag\n//     )\n//   ]\n// ]\n\n// Space\n// Space X Group\n// Group X Tag\n\nimport db, { TABLE, TYPE } from './index';\nconst max = (table: TABLE) => {\n  return Math.max(\n    0,\n    ...db<any>(table)\n      .list((x) => true)\n      .map((x) => x.id),\n  );\n};\nexport class Space {\n  static id = max(TABLE.SPACE);\n  id = Space.id;\n  alias = '';\n}\n\nexport class Tag {\n  static id = max(TABLE.TAG);\n  id = Tag.id;\n  alias = '';\n  space_id = 0;\n  type: TYPE = TYPE.USER;\n  space_alias = '';\n}\n\nexport class Group {\n  static id = max(TABLE.GROUP);\n  id = Group.id;\n  alias = '';\n  path = '';\n  is_root = false;\n  tag_id = 0;\n  children: Group[] = [];\n}\n\nexport class GroupXGroup {\n  static id = max(TABLE.GROUPXGROUP);\n  id = GroupXGroup.id;\n  group_id = 0;\n  link_group_id = 0;\n}\n\nconst DAO = {\n  Space,\n  Tag,\n  Group,\n  GroupXGroup,\n};\n\nexport default DAO;\n","export const matcher = (cond: any, item: any, boolWhenEmpty = false) => {\n  if (\n    Object.prototype.toString.call(cond) !== '[object Object]' ||\n    Object.keys(cond).length === 0\n  )\n    return boolWhenEmpty;\n  const is = Object.keys(cond).reduce((b: any, key) => {\n    if (b === false) return false;\n    const match = cond[key] === item[key];\n    return match;\n  }, null);\n  return !!is;\n};\n\nexport const transfer = (\n  node: any,\n  mapper: { before: string; after: string }[],\n) => {\n  mapper.forEach((map) => {\n    node[map.after] = node[map.before];\n  });\n  node.children = Array.isArray(node.children)\n    ? node.children.map((x: any) => transfer(x, mapper))\n    : [];\n  return node;\n};\n","import { Group, GroupXGroup } from '../db/dao';\nimport { GroupVO } from './vo';\nimport database from '../db';\nimport _ from 'lodash';\nimport { matcher } from '../utils';\nimport * as tags from './tag';\n\nconst db = database<Group>(database.TABLE.GROUP);\nconst dbx = database<GroupXGroup>(database.TABLE.GROUPXGROUP);\n\nconst fillGroupBasic = (group: Group): GroupVO => {\n  const g = group as GroupVO;\n  const tag = tags.query({ id: g.tag_id });\n  if (tag) {\n    g.tag_alias = tag.alias;\n    g.space_id = tag.space_id;\n    g.space_alias = tag.space_alias;\n    g.type = tag.type;\n  }\n  return g as GroupVO;\n};\n\nconst fillGroupLinks = (group: Group): GroupVO => {\n  const g = group as GroupVO;\n  const links = dbx\n    .list((x) => x.group_id === group.id)\n    .map((g) => fillGroupBasic(db.query((gg) => gg.id === g.link_group_id)!))\n    .reduce((o, linked) => {\n      const has = o[linked.tag_alias];\n      if (has) {\n        has.push(linked!.path);\n      } else {\n        o[linked!.tag_alias] = [linked!.path];\n      }\n      return o;\n    }, {} as GroupVO['links']);\n  g.links = links;\n  return g;\n};\n\nconst fillGroupChildren = (group: Group): GroupVO => {\n  const children = db.list((x) => {\n    const notSelf = x.path !== group.path;\n    const isMatch = x.path.startsWith(group.path);\n    const isMutiple = /#.*#/.test(x.path.replace(group.path, ''));\n    return notSelf && isMatch && !isMutiple;\n  });\n  if (Array.isArray(children)) {\n    children.forEach((g) => {\n      fillGroupBasic(g);\n      fillGroupLinks(g);\n      fillGroupChildren(g);\n    });\n    group.children = children;\n  }\n\n  return group as GroupVO;\n};\n\nconst fillGroup = (group: Group): GroupVO => {\n  const g = _.cloneDeep(group);\n  fillGroupBasic(g);\n  fillGroupLinks(g);\n  fillGroupChildren(g);\n  return g as GroupVO;\n};\n\nconst query = (group: Partial<GroupVO>) => {\n  const g = db.query((x) => matcher(group, fillGroup(x), false));\n  if (!g) return null;\n  return fillGroup(g);\n};\n\nconst list = (group?: Partial<GroupVO>) => {\n  const items = db.list((x) => matcher(group, fillGroup(x), true));\n  return items.map((g) => {\n    return fillGroup(g);\n  });\n};\n\nconst add = (\n  group: Partial<GroupVO>,\n  parent: {\n    path?: Group['path'];\n    tag_id: Group['tag_id'];\n  },\n) => {\n  const row = { ...new Group(), ...group, children: [] };\n  const links = (row as GroupVO).links;\n  // @ts-ignore\n  delete row.links;\n  row.id = ++Group.id;\n  row.path = parent.path ? `${parent.path}${row.id}#` : `ROOT${row.id}#`;\n  row.tag_id = parent.tag_id;\n  linking(links, row.id);\n  db.add(row);\n  return row.id;\n};\n\nconst linking = (links: GroupVO['links'], group_id: number) => {\n  if (!links) return;\n  const flutten = Object.keys(links).reduce((arr, k) => {\n    const ls = (links as any)[k] || [];\n    return arr.concat(\n      ls.map((path: string) => {\n        // path -> id\n        return query({ path })?.id;\n      }),\n    );\n  }, []);\n  if (flutten.length === 0) {\n    return dbx.del((i) => {\n      return i.group_id === group_id || i.link_group_id === group_id;\n    });\n  }\n  const append = flutten.reduce((o: any, id) => {\n    o[id] = 'append';\n    return o;\n  }, {});\n  dbx.query((x) => {\n    if (x.group_id === group_id) {\n      // 已经存在的\n      if (append[x.link_group_id]) {\n        delete append[x.link_group_id];\n      } else {\n        // 不存在了, 双向删除\n        dbx.del((i) => {\n          return (\n            (i.group_id === group_id && i.link_group_id === x.link_group_id) ||\n            (i.group_id === x.link_group_id && i.link_group_id === x.group_id)\n          );\n        });\n      }\n    }\n\n    return false;\n  });\n  // 双向表\n  Object.keys(append).forEach((aid) => {\n    const x = new GroupXGroup();\n    x.id = ++GroupXGroup.id;\n    x.group_id = group_id;\n    x.link_group_id = +aid;\n    dbx.add(x);\n    const r = new GroupXGroup();\n    r.id = ++GroupXGroup.id;\n    r.group_id = +aid;\n    r.link_group_id = group_id;\n    dbx.add(r);\n  });\n};\n\nconst del = (group: Partial<GroupVO>) => {\n  const d = db.query((x) => matcher(group, x, false));\n\n  // 事务??\n\n  if (!d) return;\n  // 删除关联表\n  db.list((x) => x.path.startsWith(d.path)).forEach((son) => {\n    dbx.del((x) => x.group_id === son.id || x.link_group_id === son.id);\n  });\n  // 删除本体和子节点们\n  const ret = db.del((x) => !x.is_root && x.path.startsWith(d.path));\n  return ret;\n};\n\nconst update = (group: Partial<GroupVO>) => {\n  const match: typeof group = {};\n  if (group.id) match.id = group.id;\n  if (group.tag_id) match.tag_id = group.tag_id;\n  if (group.space_id) match.space_id = group.space_id;\n  db.update(\n    (x) => matcher(match, x, false),\n    (old) => {\n      return { ...old, ...group };\n    },\n  );\n  const neo = db.query((x) => x.id === group.id);\n  if (!neo) return;\n  const next = query({ id: neo.id });\n  if (group.links && !_.isEqual(group.links, next?.links)) {\n    linking(group.links, neo.id);\n  }\n};\n\nexport { add, del, update, query, list };\n","import { Group, Space, Tag } from '../db/dao';\nimport { GroupVO, TagVO } from './vo';\nimport database from '../db';\nimport _ from 'lodash';\nimport * as groups from './group';\nimport { matcher } from '../utils';\n\nconst db = database<Tag>(database.TABLE.TAG);\nconst dbspace = database<Space>(database.TABLE.SPACE);\n\nconst query = (tag: Partial<TagVO>) => {\n  const t = db.query((x) => matcher(tag, x, false));\n  if (!t) return t;\n  const tt = _.cloneDeep(t);\n  tt.space_alias = dbspace.query((x) => x.id === t.space_id)!.alias;\n  return tt;\n};\n\nconst list = (tag?: Partial<TagVO>) => {\n  const tags = db\n    .list((x) => matcher(tag, x, true))\n    .map((t) => {\n      const tt = _.cloneDeep(t);\n      tt.space_alias = dbspace.query((x) => x.id === t.space_id)!.alias;\n      return tt;\n    });\n  return tags;\n};\n\nconst add = (tag: Omit<TagVO, 'id'>) => {\n  const row = { ...new Tag(), ...tag };\n  row.alias = tag.alias;\n  row.id = ++Tag.id;\n  db.add(row);\n  const root = new Group() as GroupVO;\n  root.alias = tag.alias;\n  root.children = [];\n  root.is_root = true;\n\n  groups.add(root, {\n    tag_id: row.id,\n  });\n  return row.id;\n};\n\nconst del = (tag: Partial<TagVO>) => {\n  const t = db.query((x) => matcher(tag, x, false));\n  if (!t) return;\n  groups.list({ tag_id: t.id }).forEach((g) => {\n    groups.del({ id: g.id });\n  });\n  const ret = db.del((x) => x.id === t.id);\n  return ret;\n};\n\nconst update = (tag: Partial<TagVO>) => {\n  const match: typeof tag = {};\n  if (tag.id) match.id = tag.id;\n  if (tag.space_id) match.space_id = tag.space_id;\n  db.update(\n    (x) => matcher({ id: tag.id }, x, false),\n    (old) => {\n      return { ...old, ...tag };\n    },\n  );\n  return db.query((x) => x.id === tag.id);\n};\n\nexport { add, del, update, query, list };\n","import { SpaceVO } from './vo';\nimport database from '../db';\nimport { Space } from '../db/dao';\nimport * as tags from './tag';\nimport { matcher } from '../utils';\n\nconst db = database<SpaceVO>(database.TABLE.SPACE);\n\nconst query = (space: Partial<SpaceVO>) => {\n  return db.query((x) => matcher(space, x, false));\n};\n\nconst list = (space?: Partial<SpaceVO>) => {\n  return db.list((x) => matcher(space, x, true));\n};\n\nconst add = (space: Omit<SpaceVO, 'id'>) => {\n  const row = { ...new Space(), ...space };\n  row.id = ++Space.id;\n  db.add(row);\n  return row.id;\n};\n\nconst del = (space: Partial<SpaceVO>) => {\n  const d = query(space)!;\n  tags.list({ space_id: d.id }).forEach((t) => {\n    tags.del({ id: t.id });\n  });\n  return db.del((x) => matcher(space, x, false));\n};\n\nconst update = (space: Partial<SpaceVO>) => {\n  return db.update(\n    (x) => matcher({ id: space.id }, x, false),\n    (old) => {\n      return { ...old, ...space };\n    },\n  );\n};\n\nexport { add, del, update, query, list };\n","import React, { FC, useCallback, useContext, useEffect, useState } from 'react';\nimport { Button, Form, Input, Table, message } from 'antd';\nimport { Link, RouteComponentProps } from '@reach/router';\nimport Ctx from '../Nav/ctx';\nimport * as Api from '../server/space';\nimport { SpaceVO } from '../server/vo';\n\nconst { Item } = Form;\nconst layout = {\n  labelCol: { span: 8 },\n  wrapperCol: { span: 16 },\n};\nconst List: FC<RouteComponentProps> = () => {\n  const ctx = useContext(Ctx);\n  const [list, setList] = useState<SpaceVO[]>([]);\n  const [form] = Form.useForm();\n  const trigger = useCallback(() => {\n    const list = Api.list();\n    setList(list);\n    ctx.update();\n  }, [ctx]);\n  useEffect(() => {\n    trigger();\n  }, [trigger]);\n  const toSubmit = useCallback(\n    (values) => {\n      console.log('values', values);\n      if (values.id) {\n        Api.update(values);\n        message.success('更新完成');\n      } else {\n        Api.add(values);\n        message.success('保存成功');\n      }\n      trigger();\n    },\n    [trigger],\n  );\n  return (\n    <div style={{ display: 'flex' }}>\n      <div style={{ flex: 1 }}>\n        <div>\n          <Button\n            type=\"primary\"\n            onClick={() => {\n              form.setFieldsValue({ alias: '', id: '' });\n            }}\n          >\n            新增\n          </Button>\n        </div>\n        <Table\n          rowKey=\"id\"\n          dataSource={list}\n          columns={[\n            { key: 'id', dataIndex: 'id', title: 'ID' },\n            { key: 'alias', dataIndex: 'alias', title: 'ALIAS' },\n            {\n              key: '__op__',\n              render(row) {\n                return (\n                  <div>\n                    <Button\n                      onClick={() => {\n                        Api.del({ id: row.id });\n                        trigger();\n                      }}\n                      type=\"dashed\"\n                    >\n                      删除\n                    </Button>\n                    <Button\n                      type=\"primary\"\n                      onClick={() => {\n                        form.setFieldsValue(row);\n                      }}\n                    >\n                      修改\n                    </Button>\n                    <Link to={`/ace/tag/${row.id}`}>\n                      <Button>编辑TAG</Button>\n                    </Link>\n                  </div>\n                );\n              },\n            },\n          ]}\n        ></Table>\n      </div>\n      <div style={{ flex: 1 }}>\n        <h3>编辑区</h3>\n        <Form {...layout} form={form} onFinish={toSubmit}>\n          <Item name=\"id\" label=\"ID\" required>\n            <Input disabled></Input>\n          </Item>\n          <Item name=\"alias\" label=\"ALIAS\" required>\n            <Input></Input>\n          </Item>\n          <Button type=\"primary\" htmlType=\"submit\">\n            保存\n          </Button>\n        </Form>\n      </div>\n    </div>\n  );\n};\n\nexport default List;\n","import React, { FC, useCallback, useContext, useEffect, useState } from 'react';\nimport { Button, Form, Input, Radio, Table, message } from 'antd';\nimport { Link, RouteComponentProps, useParams } from '@reach/router';\nimport * as Api from '../server/tag';\nimport { TagVO } from '../server/vo';\nimport Ctx from '../Nav/ctx';\nimport { TYPE } from '../db';\n\nconst { Item } = Form;\nconst { Group: RadioGroup } = Radio;\nconst layout = {\n  labelCol: { span: 8 },\n  wrapperCol: { span: 16 },\n};\nconst List: FC<RouteComponentProps> = () => {\n  const [list, setList] = useState<TagVO[]>([]);\n  const ctx = useContext(Ctx);\n  const params = useParams();\n  const [form] = Form.useForm();\n  const trigger = useCallback(() => {\n    setList(Api.list({ space_id: +params.space_id }));\n    ctx.update();\n  }, [ctx, params.space_id]);\n  useEffect(() => {\n    trigger();\n  }, [trigger]);\n  const toSubmit = useCallback(\n    (values) => {\n      values.space_id = +params.space_id;\n      if (values.id) {\n        Api.update(values);\n        message.success('更新完成');\n      } else {\n        Api.add(values);\n        message.success('保存成功');\n      }\n      trigger();\n    },\n    [params.space_id, trigger],\n  );\n  return (\n    <div style={{ display: 'flex' }}>\n      <div style={{ flex: 1 }}>\n        <div>\n          <Button\n            type=\"primary\"\n            onClick={() => {\n              form.setFieldsValue({ alias: '', id: '' });\n            }}\n          >\n            新增\n          </Button>\n        </div>\n        <Table\n          rowKey=\"id\"\n          dataSource={list}\n          columns={[\n            { key: 'id', dataIndex: 'id', title: 'ID' },\n            { key: 'alias', dataIndex: 'alias', title: 'ALIAS' },\n            { key: 'type', dataIndex: 'type', title: 'TYPE' },\n            {\n              key: 'space_alias',\n              dataIndex: 'space_alias',\n              title: 'SPACE_ALIAS',\n            },\n            {\n              key: '__op__',\n              render(row) {\n                return (\n                  <div>\n                    <Button\n                      onClick={() => {\n                        Api.del({ id: row.id });\n                        trigger();\n                      }}\n                      type=\"dashed\"\n                    >\n                      删除\n                    </Button>\n                    <Button\n                      type=\"primary\"\n                      onClick={() => {\n                        form.setFieldsValue(row);\n                      }}\n                    >\n                      修改\n                    </Button>\n                    <Link to={`/ace/group/${params.space_id}/${row.id}`}>\n                      <Button>编辑GROUP</Button>\n                    </Link>\n                  </div>\n                );\n              },\n            },\n          ]}\n        ></Table>\n      </div>\n      <div style={{ flex: 1 }}>\n        <h3>编辑区</h3>\n        <Form {...layout} form={form} onFinish={toSubmit}>\n          <Item name=\"id\" label=\"ID\" required>\n            <Input disabled></Input>\n          </Item>\n          <Item name=\"alias\" label=\"ALIAS\" required>\n            <Input></Input>\n          </Item>\n          <Item name=\"type\" label=\"TYPE\" required>\n            <RadioGroup\n              options={[\n                {\n                  label: TYPE.USER,\n                  value: TYPE.USER,\n                },\n                {\n                  label: TYPE.ROLE,\n                  value: TYPE.ROLE,\n                },\n                {\n                  label: TYPE.DATA,\n                  value: TYPE.DATA,\n                },\n                {\n                  label: TYPE.RESOURCE,\n                  value: TYPE.RESOURCE,\n                },\n              ]}\n            ></RadioGroup>\n          </Item>\n          <Button type=\"primary\" htmlType=\"submit\">\n            保存\n          </Button>\n        </Form>\n      </div>\n    </div>\n  );\n};\n\nexport default List;\n","import React, { FC, useEffect, useRef, useState } from 'react';\nimport { Tree } from 'antd';\n\ntype Props = {\n  value?: string[];\n  onChange?: (value: string[]) => void;\n  tree: any[];\n};\n\nconst keys = (tree: any[]): string[] => {\n  let arr: string[] = [];\n  if (Array.isArray(tree)) {\n    tree.forEach((node) => {\n      arr.push(node.key);\n      const child = keys(node.children);\n      if (child) {\n        arr = arr.concat(child);\n      }\n    });\n  } else {\n    return [];\n  }\n  return arr;\n};\n\nconst TreeSelector: FC<Props> = ({ value, onChange, tree }) => {\n  const expanded = useRef(false);\n  const [expandedKeys, setExpandedKeys] = useState<string[]>(() => keys(tree));\n  const [autoExpandParent, setAutoExpandParent] = useState<boolean>(true);\n\n  const onExpand = (expandedKeys: any) => {\n    setExpandedKeys(expandedKeys);\n    setAutoExpandParent(false);\n  };\n\n  useEffect(() => {\n    if (expanded.current) return;\n    if (Array.isArray(value)) {\n      expanded.current = true;\n      setExpandedKeys(value);\n    }\n  }, [value]);\n\n  const onCheck = (checkedKeys: any) => {\n    if (onChange) {\n      onChange(checkedKeys);\n    }\n  };\n\n  return (\n    <Tree\n      checkable\n      onExpand={onExpand}\n      expandedKeys={expandedKeys}\n      autoExpandParent={autoExpandParent}\n      onCheck={onCheck}\n      checkedKeys={value}\n      treeData={tree}\n    />\n  );\n};\n\nexport default TreeSelector;\n","import React, { FC, useCallback, useEffect, useRef, useState } from 'react';\nimport { Button, Col, Form, Input, Row, Tree, message } from 'antd';\nimport { RouteComponentProps, useLocation, useParams } from '@reach/router';\nimport * as Api from '../server/group';\nimport { TYPE } from '../db';\nimport { GroupVO } from '../server/vo';\nimport TreeSelector from '../comps/TreeSelector';\nimport { transfer } from '../utils';\n\nconst { Item } = Form;\nconst layout = {\n  labelCol: { span: 8 },\n  wrapperCol: { span: 16 },\n};\n\nconst watedTypes = (type: TYPE) => {\n  switch (type) {\n    case TYPE.USER:\n      return [TYPE.DATA, TYPE.ROLE];\n    case TYPE.DATA:\n      return [TYPE.USER];\n    case TYPE.RESOURCE:\n      return [TYPE.ROLE];\n    case TYPE.ROLE:\n      return [TYPE.USER, TYPE.RESOURCE];\n    default:\n      return [];\n  }\n};\n\nconst keys = (tree: any[]): string[] => {\n  let arr: string[] = [];\n  if (Array.isArray(tree)) {\n    tree.forEach((node) => {\n      arr.push(node.key);\n      const child = keys(node.children);\n      if (child) {\n        arr = arr.concat(child);\n      }\n    });\n  } else {\n    return [];\n  }\n  return arr;\n};\n\nconst List: FC<RouteComponentProps> = () => {\n  const location = useLocation();\n  const [expandedKeys, setExpandedKeys] = useState<string[]>([]);\n  const [autoExpandParent, setAutoExpandParent] = useState<boolean>(true);\n\n  const onExpand = (expandedKeys: any) => {\n    setExpandedKeys(expandedKeys);\n    setAutoExpandParent(false);\n  };\n  const [tree, setTree] = useState<any>([]);\n  const [dataSource, setDataSource] = useState<any>({});\n  const params = useParams();\n  const [form] = Form.useForm();\n\n  const parenting = useRef<GroupVO>();\n  const [now, setNow] = useState<GroupVO>();\n  const [up, setUp] = useState(1);\n\n  useEffect(() => {\n    setNow({} as any);\n    parenting.current = undefined;\n    form.resetFields();\n    setUp(-1);\n    setTimeout(() => {\n      setUp(1);\n    });\n  }, [form, location]);\n  useEffect(() => {\n    setUp(-1);\n    setTimeout(() => {\n      setUp(1);\n    });\n  }, [now]);\n\n  const trigger = useCallback(() => {\n    const root = Api.query({\n      space_id: +params.space_id,\n      tag_id: +params.tag_id,\n      is_root: true,\n    });\n    const transfer = (node: any) => {\n      node.title = (\n        <Row gutter={16}>\n          <Col>\n            <div>{node.alias}</div>\n          </Col>\n          <Col>\n            <Button\n              type=\"link\"\n              onClick={(e) => {\n                e.stopPropagation();\n                Api.del({ id: node.id });\n                trigger();\n              }}\n            >\n              删除\n            </Button>\n          </Col>\n          <Col>\n            <Button\n              type=\"link\"\n              onClick={(e) => {\n                e.stopPropagation();\n                form.resetFields();\n                form.setFieldsValue(node);\n              }}\n            >\n              查看\n            </Button>\n          </Col>\n          <Col>\n            <Button\n              type=\"link\"\n              onClick={(e) => {\n                e.stopPropagation();\n                const neo: any = {};\n                parenting.current = node;\n                setNow(node);\n                form.resetFields();\n                form.setFieldsValue(neo);\n              }}\n            >\n              添加子节点\n            </Button>\n          </Col>\n        </Row>\n      );\n      node.key = node.path;\n      node.children = Array.isArray(node.children)\n        ? node.children.map((x: any) => transfer(x))\n        : [];\n      return node;\n    };\n    const tree = [transfer(root || {})];\n    setTree(tree);\n    setExpandedKeys(keys(tree));\n  }, [form, params.space_id, params.tag_id]);\n\n  useEffect(() => {\n    trigger();\n  }, [trigger]);\n\n  const toSubmit = useCallback(\n    (values) => {\n      if (values.id) {\n        Api.update(values);\n        message.success('更新完成');\n      } else {\n        if (!parenting.current) {\n          return message.error('请先选择父节点');\n        }\n        Api.add(values, parenting.current);\n        message.success('保存成功');\n      }\n      trigger();\n    },\n    [trigger],\n  );\n\n  const tags = useCallback(() => {\n    if (!tree[0]) return;\n    const types = watedTypes(tree[0].type);\n    const trees = types.reduce((o: any, type) => {\n      const nodes = Api.list({ type, is_root: true });\n      const tree = nodes.reduce((a: any, node) => {\n        if (!node) return [];\n        const t = transfer(node, [\n          { before: 'alias', after: 'title' },\n          {\n            before: 'path',\n            after: 'key',\n          },\n        ]);\n        a[node.alias] = [t];\n        return a;\n      }, {});\n      o[type] = tree;\n      return o;\n    }, {});\n    setDataSource(trees);\n  }, [tree]);\n\n  useEffect(() => {\n    tags();\n  }, [tags]);\n\n  return (\n    <div style={{ display: 'flex' }}>\n      <div style={{ flex: 1 }}>\n        <Tree\n          expandedKeys={expandedKeys}\n          onExpand={onExpand}\n          autoExpandParent={autoExpandParent}\n          showLine\n          treeData={tree}\n        ></Tree>\n      </div>\n      <div style={{ flex: 1 }}>\n        <h3>编辑区</h3>\n        <div>\n          <h4>\n            当前父节点: {now?.alias} / {now?.path}\n          </h4>\n        </div>\n        {up > 0 ? (\n          <Form {...layout} form={form} onFinish={toSubmit}>\n            <Item name=\"id\" label=\"ID\" required>\n              <Input disabled></Input>\n            </Item>\n            <Item name=\"path\" label=\"PATH\" required>\n              <Input disabled></Input>\n            </Item>\n            <Item name=\"alias\" label=\"ALIAS\" required>\n              <Input></Input>\n            </Item>\n            {Object.keys(dataSource).map((type) => {\n              return (\n                <div key={type}>\n                  <h2>{type}</h2>\n                  <div>\n                    {Object.keys(dataSource[type]).map((alias) => {\n                      return (\n                        <Item key={alias} name={['links', alias]} label={alias}>\n                          <TreeSelector\n                            tree={dataSource[type][alias]}\n                          ></TreeSelector>\n                        </Item>\n                      );\n                    })}\n                  </div>\n                </div>\n              );\n            })}\n\n            <Button type=\"primary\" htmlType=\"submit\">\n              保存\n            </Button>\n          </Form>\n        ) : null}\n      </div>\n    </div>\n  );\n};\n\nexport default List;\n","import { RouteComponentProps } from '@reach/router';\nimport { Table } from 'antd';\nimport React, { FC, useEffect, useState } from 'react';\nimport database from '../db';\nimport * as spaces from '../server/space';\nimport * as tags from '../server/tag';\nimport * as groups from '../server/group';\n\nconst List: FC<RouteComponentProps> = () => {\n  const [spaceList, setSpaceList] = useState<any[]>([]);\n  const [tagList, setTagList] = useState<any[]>([]);\n  const [groupList, setGroupList] = useState<any[]>([]);\n  const [xList, setXList] = useState<any[]>([]);\n  useEffect(() => {\n    setSpaceList(spaces.list());\n    setTagList(tags.list());\n    setGroupList(groups.list().map((x: any) => ({ ...x, children: null })));\n    setXList(database(database.TABLE.GROUPXGROUP).list(() => true));\n  }, []);\n  return (\n    <div>\n      <h2>SPACE</h2>\n      <Table\n        rowKey=\"id\"\n        dataSource={spaceList}\n        columns={[\n          { key: 'id', dataIndex: 'id', title: 'ID' },\n          { key: 'alias', dataIndex: 'alias', title: 'ALIAS' },\n        ]}\n      ></Table>\n      <h2>TAG</h2>\n      <Table\n        rowKey=\"id\"\n        dataSource={tagList}\n        columns={[\n          { key: 'id', dataIndex: 'id', title: 'ID' },\n          { key: 'alias', dataIndex: 'alias', title: 'ALIAS' },\n          { key: 'type', dataIndex: 'type', title: 'TYPE' },\n          {\n            key: 'space_id',\n            dataIndex: 'space_id',\n            title: 'SPACE_ID',\n          },\n          {\n            key: 'space_alias',\n            dataIndex: 'space_alias',\n            title: 'SPACE_ALIAS',\n          },\n        ]}\n      ></Table>\n      <h2>GROUP</h2>\n      <Table\n        rowKey=\"id\"\n        dataSource={groupList}\n        columns={[\n          { key: 'id', dataIndex: 'id', title: 'ID' },\n          { key: 'alias', dataIndex: 'alias', title: 'ALIAS' },\n          { key: 'type', dataIndex: 'type', title: 'TYPE' },\n          { key: 'tag_id', dataIndex: 'tag_id', title: 'TAG_ID' },\n          { key: 'tag_alias', dataIndex: 'tag_alias', title: 'TAG_ALIAS' },\n          {\n            key: 'space_id',\n            dataIndex: 'space_id',\n            title: 'SPACE_ID',\n          },\n          {\n            key: 'space_alias',\n            dataIndex: 'space_alias',\n            title: 'SPACE_ALIAS',\n          },\n        ]}\n      ></Table>\n      <h2>GROUP X GROUP</h2>\n      <Table\n        rowKey=\"id\"\n        dataSource={xList}\n        columns={[\n          { key: 'id', dataIndex: 'id', title: 'ID' },\n          { key: 'group_id', dataIndex: 'group_id', title: 'GROUP_ID' },\n          {\n            key: 'link_group_id',\n            dataIndex: 'link_group_id',\n            title: 'LINK_GROUP_ID',\n          },\n        ]}\n      ></Table>\n    </div>\n  );\n};\n\nexport default List;\n","import React, { useEffect, useState } from 'react';\nimport Nav from './Nav';\nimport _ from 'lodash';\nimport Ctx, { Menu } from './Nav/ctx';\nimport { Space as Box, Card } from 'antd';\n\nimport { GithubOutlined } from '@ant-design/icons';\nimport { RouteComponentProps, Router } from '@reach/router';\nimport Space from './Space';\nimport Tag from './Tag';\nimport Group from './Group';\nimport TABLE from './TABLE';\nimport * as tags from './server/tag';\nimport * as spaces from './server/space';\n\nconst up = (updater: React.Dispatch<React.SetStateAction<Menu[]>>) => {\n  return () => {\n    const spacelist: Menu[] = spaces.list().map((x) => {\n      return {\n        key: x.id.toString(),\n        name: `🛸_${x.alias}`,\n        url: `/ace/tag/${x.id}`,\n      };\n    });\n    const list: Menu[] = tags.list().map((x) => {\n      return {\n        key: x.id.toString() + x.space_id + x.id,\n        name: `🚀____${x.alias}`,\n        url: `/ace/group/${x.space_id}/${x.id}`,\n      };\n    });\n    updater((x) => {\n      const menus = x.concat(spacelist).concat(list);\n      return _.uniqBy(menus, (x) => x.key);\n    });\n  };\n};\n\nlet Home = (props: RouteComponentProps) => (\n  <div>\n    <Box direction=\"vertical\" style={{ width: '100%' }} size=\"large\">\n      <Card title=\"USER\">\n        <Card.Grid>&nbsp;USER X DATA</Card.Grid>\n        <Card.Grid>&nbsp;USER X ROLE</Card.Grid>\n      </Card>\n      <Card title=\"DATA\">\n        <Card.Grid>&nbsp;DATA X USER</Card.Grid>\n      </Card>\n      <Card title=\"RESOURCE\">\n        <Card.Grid>&nbsp;RESOURCE X ROLE</Card.Grid>\n      </Card>\n      <Card title=\"ROLE\">\n        <Card.Grid>&nbsp;ROLE X USER</Card.Grid>\n        <Card.Grid>&nbsp;ROLE X RESOURCE</Card.Grid>\n      </Card>\n    </Box>\n  </div>\n);\n\nexport const App: React.FunctionComponent = () => {\n  const [menus, setMenus] = useState<Menu[]>([\n    {\n      key: 'HOME',\n      name: 'HOME',\n      url: '/ace',\n    },\n    {\n      key: 'TABLE',\n      name: 'TABLE',\n      url: '/ace/table',\n    },\n    {\n      key: 'SPACE',\n      name: 'SPACE',\n      url: '/ace/space',\n    },\n  ]);\n  useEffect(() => {\n    up(setMenus)();\n  }, []);\n\n  return (\n    <Ctx.Provider value={{ menus, update: up(setMenus) }}>\n      <div\n        style={{\n          height: '100vh',\n          display: 'flex',\n          flexDirection: 'column',\n        }}\n      >\n        <div\n          style={{\n            padding: '8px',\n            boxShadow: '0px 0px 12px #cecece',\n            display: 'flex',\n            justifyContent: 'space-between',\n          }}\n        >\n          <h2>\n            <span aria-label=\"fireman\" role=\"img\">\n              🚒\n            </span>\n            &nbsp; Access Control Evolved\n          </h2>\n          <h2>\n            <a href=\"https://github.com/charlzyx/ace\">\n              <GithubOutlined translate=\"span\" />\n            </a>\n          </h2>\n        </div>\n        <div style={{ flex: 1, display: 'flex', padding: '16px' }}>\n          <div style={{ width: '200px', height: '100vh' }}>\n            <Nav></Nav>\n          </div>\n          <div style={{ height: '100vh', width: '100%', padding: '0 8px' }}>\n            <Router basepath=\"/ace\">\n              <Home path=\"/\"></Home>\n              <Space path=\"/space\"></Space>\n              <Tag path=\"/tag/:space_id\"></Tag>\n              <Group path=\"/group/:space_id/:tag_id\"></Group>\n              <TABLE path=\"/table\"></TABLE>\n            </Router>\n          </div>\n        </div>\n      </div>\n    </Ctx.Provider>\n  );\n};\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href,\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA',\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentTag = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentTag != null && contentTag.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { App } from './App';\nimport * as serviceWorker from './serviceWorker';\nimport 'antd/dist/antd.css'; // or 'antd/dist/antd.less'\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}