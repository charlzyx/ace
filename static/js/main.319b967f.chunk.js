(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{178:function(e,t,a){e.exports=a(357)},357:function(e,t,a){"use strict";a.r(t);var n,i,r=a(0),l=a.n(r),c=a(11),u=a.n(c),o=a(24),s={name:"A SPACE ODYSSEY",links:[{key:"HOME",name:"HOME",url:"/"},{key:"SPACE",name:"SPACE",url:"/space"}]},d=function(){return l.a.createElement("div",{style:{borderRight:"1px solid #ececec",height:"100%"}},l.a.createElement("p",{style:{fontWeight:"bold"}},s.name),s.links.map(function(e){return l.a.createElement(o.a,{key:e.key,to:e.url},l.a.createElement("div",{style:{padding:"16px"}},e.name))}))},p=a(19),f=a(361),E=a(26),m=a(360),h=a(362),y=a(23),_=a(69),b=a(175);!function(e){e.SPACE="SPACE",e.TAG="TAG",e.GROUP="GROUP",e.GROUPXGROUP="GROUPXGROUP"}(n||(n={})),function(e){e.USER="USER",e.ROLE="ROLE",e.DATA="DATA",e.RESOURCE="RESOURCE"}(i||(i={}));var v=window.localStorage,O=function(e){var t=function(){var t=v.getItem(n[e]);return t?JSON.parse(t):[]},a=t();return new Proxy(a,{get:function(e,n){return a=t(),Reflect.get(a,n)},set:function(t,i,r){return Reflect.set(a,i,r),v.setItem(n[e],JSON.stringify(a)),!0}})},g=function(e){return{add:function(t){return function(e,t){return O(e).push(t),!0}(e,t)},del:function(t){return function(e,t){var a=O(e),n=a.findIndex(t);return n>-1&&(a.splice(n,1),!0)}(e,t)},update:function(t,a){return function(e,t,a){var n=O(e),i=n.findIndex(t);return i>-1&&(n[i]=a(n[i]),!0)}(e,t,a)},query:function(t){return function(e,t){return O(e).find(t)}(e,t)},list:function(t){return function(e,t){return O(e).filter(t)}(e,t)}}};g.TABLE=n;var A=g,k=function(e){return Math.max.apply(Math,[0].concat(Object(b.a)(A(e).list(function(e){return!0}).map(function(e){return e.id}))))},j=function e(){Object(_.a)(this,e),this.id=e.id,this.alias=""};j.id=k(n.SPACE);var R=function e(){Object(_.a)(this,e),this.id=e.id,this.alias="",this.space_id=0,this.type=i.USER,this.space_alias=""};R.id=k(n.TAG);var S=function e(){Object(_.a)(this,e),this.id=e.id,this.alias="",this.path="",this.is_root=!1,this.type=i.USER,this.tag_id=0,this.tag_alias="",this.space_id=0,this.space_alias="",this.children=[]};S.id=k(n.GROUP);var C=function e(){Object(_.a)(this,e),this.id=e.id,this.group_id=0,this.group_alias="",this.link_group_id=0,this.link_group_alias=""};C.id=k(n.GROUPXGROUP);var x=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"[object Object]"!==Object.prototype.toString.call(e)||0===Object.keys(e).length?a:!!Object.keys(e).reduce(function(a,n){return!1!==a&&e[n]===t[n]},null)},P=A(A.TABLE.SPACE),T=f.a.Item,U={labelCol:{span:8},wrapperCol:{span:16}},w=function(){var e=Object(r.useState)([]),t=Object(p.a)(e,2),a=t[0],n=t[1],i=f.a.useForm(),c=Object(p.a)(i,1)[0],u=Object(r.useCallback)(function(){var e;n(P.list(function(t){return x(e,t,!0)}))},[]);Object(r.useEffect)(function(){u()},[u]);var s=Object(r.useCallback)(function(e){var t;console.log("values",e),e.id?(t=e,P.update(function(e){return x({id:t.id},e,!1)},function(e){return Object(y.a)({},e,t)})):function(e){var t=Object(y.a)({},new j,e);t.id=++j.id,P.add(t),t.id}(e),u()},[u]);return l.a.createElement("div",{style:{display:"flex"}},l.a.createElement("div",{style:{flex:1}},l.a.createElement("div",null,l.a.createElement(E.a,{type:"primary",onClick:function(){c.setFieldsValue({alias:"",id:""})}},"\u65b0\u589e")),l.a.createElement(m.a,{dataSource:a,columns:[{key:"id",dataIndex:"id",title:"ID"},{key:"alias",dataIndex:"alias",title:"ALIAS"},{key:"__op__",render:function(e){return l.a.createElement("div",null,l.a.createElement(E.a,{onClick:function(){var t;t={id:e.id},P.del(function(e){return x(t,e,!1)}),u()},type:"dashed"},"\u5220\u9664"),l.a.createElement(E.a,{type:"primary",onClick:function(){c.setFieldsValue(e)}},"\u4fee\u6539"),l.a.createElement(o.a,{to:"/tag/".concat(e.id)},l.a.createElement(E.a,null,"\u7f16\u8f91TAG")))}}]})),l.a.createElement("div",{style:{flex:1}},l.a.createElement("h3",null,"\u7f16\u8f91\u533a"),l.a.createElement(f.a,Object.assign({},U,{form:c,onFinish:s}),l.a.createElement(T,{name:"id",label:"ID",required:!0},l.a.createElement(h.a,{disabled:!0})),l.a.createElement(T,{name:"alias",label:"ALIAS",required:!0},l.a.createElement(h.a,null)),l.a.createElement(E.a,{type:"primary",htmlType:"submit"},"\u4fdd\u5b58"))))},I=a(87),L=A(A.TABLE.GROUP),G=A(A.TABLE.GROUPXGROUP),q=A(A.TABLE.TAG),D=A(A.TABLE.SPACE),F=function(e){var t=e,a=G.list(function(t){return t.group_id===e.id}).map(function(e){return L.query(function(t){return t.id===e.link_group_id})}).reduce(function(e,t){var a=e[t.tag_alias];return a?a.push({id:t.id,alias:t.alias}):e[t.tag_alias]=[{id:t.id,alias:t.alias}],e},{});t.links=a},B=function(e){e.space_alias=D.query(function(t){return t.id===e.space_id}).alias,e.tag_alias=q.query(function(t){return t.id===e.tag_id}).alias},V=function e(t){var a=L.list(function(e){var a=e.path!==t.path,n=e.path.startsWith(t.path),i=/#.*#/.test(e.path.replace(t.path,""));return a&&n&&!i});Array.isArray(a)&&(a.forEach(function(t){B(t),F(t),e(t)}),t.children=a)},W=function(e,t){var a=Object(y.a)({},new S,e);return a.id=++S.id,a.path=t.path?"".concat(t.path).concat(a.id,"#"):"ROOT".concat(a.id,"#"),a.space_id=t.space_id,a.space_alias=t.space_alias,a.tag_id=t.tag_id,a.tag_alias=t.tag_alias,a.type=t.type,L.add(a),a.id},H=function(e){var t=L.query(function(t){return x(e,t,!1)});if(t)return L.list(function(e){return e.path.startsWith(t.path)}).forEach(function(e){G.del(function(t){return t.group_id===e.id||t.link_group_id===e.id})}),L.del(function(e){return!e.is_root&&e.path.startsWith(t.path)})},J=function(e){var t={};return e.id&&(t.id=e.id),e.tag_id&&(t.tag_id=e.tag_id),e.space_id&&(t.space_id=e.space_id),L.update(function(e){return x(t,e,!1)},function(t){return Object(y.a)({},t,e)})},M=A(A.TABLE.TAG),X=A(A.TABLE.SPACE),Y=f.a.Item,N=I.default.Group,K={labelCol:{span:8},wrapperCol:{span:16}},$=function(){var e=Object(r.useState)([]),t=Object(p.a)(e,2),a=t[0],n=t[1],c=Object(o.c)(),u=f.a.useForm(),s=Object(p.a)(u,1)[0],d=Object(r.useCallback)(function(){var e;n((e={space_id:+c.space_id},M.list(function(t){return x(e,t,!0)})))},[c.space_id]);Object(r.useEffect)(function(){d()},[d]);var _=Object(r.useCallback)(function(e){console.log("values",e),e.space_id=+c.space_id,e.id?function(e){var t={};e.id&&(t.id=e.id),e.space_id&&(t.space_id=e.space_id),M.update(function(t){return x({id:e.id},t,!1)},function(t){var a=Object(y.a)({},t,e);return J({tag_id:a.id,type:a.type,tag_alias:a.alias}),a})}(e):function(e){var t=Object(y.a)({},new R,e);t.space_alias=X.query(function(t){return t.id===e.space_id}).alias,t.alias=e.alias,t.id=++R.id,M.add(t);var a=new S;a.alias=e.alias,a.children=[],a.is_root=!0,W(a,{space_alias:t.space_alias,space_id:t.space_id,tag_id:t.id,tag_alias:t.alias,type:t.type}),t.id}(e),d()},[c.space_id,d]);return l.a.createElement("div",{style:{display:"flex"}},l.a.createElement("div",{style:{flex:1}},l.a.createElement("div",null,l.a.createElement(E.a,{type:"primary",onClick:function(){s.setFieldsValue({alias:""})}},"\u65b0\u589e")),l.a.createElement(m.a,{dataSource:a,columns:[{key:"id",dataIndex:"id",title:"ID"},{key:"alias",dataIndex:"alias",title:"ALIAS"},{key:"type",dataIndex:"type",title:"TYPE"},{key:"space_alias",dataIndex:"space_alias",title:"SPACE_ALIAS"},{key:"__op__",render:function(e){return l.a.createElement("div",null,l.a.createElement(E.a,{onClick:function(){!function(e){var t=M.query(function(t){return x(e,t,!1)});if(t)H({tag_id:t.id}),M.del(function(e){return e.id===t.id})}({id:e.id}),d()},type:"dashed"},"\u5220\u9664"),l.a.createElement(E.a,{type:"primary",onClick:function(){s.setFieldsValue(e)}},"\u4fee\u6539"),l.a.createElement(o.a,{to:"/group/".concat(c.space_id,"/").concat(e.id)},l.a.createElement(E.a,null,"\u7f16\u8f91GROUP")))}}]})),l.a.createElement("div",{style:{flex:1}},l.a.createElement("h3",null,"\u7f16\u8f91\u533a"),l.a.createElement(f.a,Object.assign({},K,{form:s,onFinish:_}),l.a.createElement(Y,{name:"id",label:"ID",required:!0},l.a.createElement(h.a,{disabled:!0})),l.a.createElement(Y,{name:"alias",label:"ALIAS",required:!0},l.a.createElement(h.a,null)),l.a.createElement(Y,{name:"type",label:"TYPE",required:!0},l.a.createElement(N,{options:[{label:i.USER,value:i.USER},{label:i.ROLE,value:i.ROLE},{label:i.DATA,value:i.DATA},{label:i.RESOURCE,value:i.RESOURCE}]})),l.a.createElement(E.a,{type:"primary",htmlType:"submit"},"\u4fdd\u5b58"))))},z=a(358),Q=a(359),Z=a(363),ee=function(e){var t=e.value,a=e.onChange,n=e.tree,i=Object(r.useState)([]),c=Object(p.a)(i,2),u=c[0],o=c[1],s=Object(r.useState)(!0),d=Object(p.a)(s,2),f=d[0],E=d[1];return l.a.createElement(Z.a,{checkable:!0,onExpand:function(e){console.log("onExpand",e),o(e),E(!1)},expandedKeys:u,autoExpandParent:f,onCheck:function(e){console.log("onCheck",e),a&&a(e)},checkedKeys:t,treeData:n})},te=f.a.Item,ae={labelCol:{span:8},wrapperCol:{span:16}},ne=function(){var e=Object(r.useState)([]),t=Object(p.a)(e,2),a=t[0],n=t[1],c=Object(r.useState)({}),u=Object(p.a)(c,2),s=u[0],d=u[1],m=Object(o.c)(),_=f.a.useForm(),b=Object(p.a)(_,1)[0],v=Object(r.useCallback)(function(){var e=function(e){console.log("group",e);var t=L.query(function(t){return x(e,t,!1)});return t?(B(t),F(t),V(t),t):null}({space_id:+m.space_id,tag_id:+m.tag_id,is_root:!0});console.log("root",e),n([function e(t){return t.title=l.a.createElement(z.a,{gutter:16},l.a.createElement(Q.a,null,l.a.createElement("div",null,t.alias)),l.a.createElement(Q.a,null,l.a.createElement(E.a,{type:"link",onClick:function(e){e.stopPropagation(),H({id:t.id}),v()}},"\u5220\u9664")),l.a.createElement(Q.a,null,l.a.createElement(E.a,{type:"link",onClick:function(e){e.stopPropagation(),b.setFieldsValue(t)}},"\u67e5\u770b")),l.a.createElement(Q.a,null,l.a.createElement(E.a,{type:"link",onClick:function(e){e.stopPropagation();var a={};a.parentPath=t.path,b.setFieldsValue(a)}},"\u6dfb\u52a0\u5b50\u8282\u70b9"))),t.key=t.path,t.children=Array.isArray(t.children)?t.children.map(function(t){return e(t)}):[],t}(e||{})])},[b,m.space_id,m.tag_id]);Object(r.useEffect)(function(){v()},[v]);var O=Object(r.useCallback)(function(e){console.log("values",e),e.id?J(Object(y.a)({},e,{space_id:+m.space_id,tag_id:+m.tag_id})):W(Object(y.a)({},e,{space_id:+m.space_id,tag_id:+m.tag_id}),e.parentPath),v()},[m.space_id,m.tag_id,v]),g=Object(r.useCallback)(function(){if(a[0]){var e=function(e){switch(e){case i.USER:return[i.DATA,i.ROLE];case i.DATA:return[i.USER];case i.RESOURCE:return[i.ROLE];case i.ROLE:return[i.USER,i.RESOURCE];default:return[]}}(a[0].type).reduce(function(e,t){var a,n=(a={type:t},console.log("group",a),L.list(function(e){return x(a,e,!1)}).map(function(e){return B(e),F(e),V(e),e})).reduce(function(e,t){if(!t)return[];var a=function e(t,a){return a.forEach(function(e){t[e.after]=t[e.before]}),t.children=Array.isArray(t.children)?t.children.map(function(t){return e(t,a)}):[],t}(t,[{before:"alias",after:"title"},{before:"path",after:"key"}]);return e[t.alias]=[a],e},{});return console.log("treeeeee".concat(t),n),e[t]=n,e},{});d(e),console.log("trees",e)}},[a]);return Object(r.useEffect)(function(){g()},[g]),l.a.createElement("div",{style:{display:"flex"}},l.a.createElement("div",{style:{flex:1}},l.a.createElement(Z.a,{autoExpandParent:!0,defaultExpandAll:!0,showLine:!0,treeData:a})),l.a.createElement("div",{style:{flex:1}},l.a.createElement("h3",null,"\u7f16\u8f91\u533a"),l.a.createElement(f.a,Object.assign({},ae,{form:b,onFinish:O}),l.a.createElement(te,{name:"id",label:"ID",required:!0},l.a.createElement(h.a,{disabled:!0})),l.a.createElement(te,{name:"parentPath",label:"PARENT_PATH",required:!0},l.a.createElement(h.a,{disabled:!0})),l.a.createElement(te,{name:"path",label:"PATH",required:!0},l.a.createElement(h.a,{disabled:!0})),l.a.createElement(te,{name:"alias",label:"ALIAS",required:!0},l.a.createElement(h.a,null)),Object.keys(s).map(function(e){return l.a.createElement("div",null,l.a.createElement("h2",null,e),l.a.createElement("div",null,Object.keys(s[e]).map(function(t){return l.a.createElement(te,{name:"".concat(e,".").concat(t),label:"".concat(e,".").concat(t)},l.a.createElement(ee,{tree:s[e][t]}))})))}),l.a.createElement(E.a,{type:"primary",htmlType:"submit"},"\u4fdd\u5b58"))))},ie=function(e){return l.a.createElement("div",null,"Home")};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(356);u.a.render(l.a.createElement(function(){return l.a.createElement("div",{style:{height:"100vh",display:"flex",flexDirection:"column"}},l.a.createElement("div",{style:{padding:"8px",boxShadow:"0px 0px 12px #cecece"}},l.a.createElement("h2",null,"Access Control Evolved")),l.a.createElement("div",{style:{flex:1,display:"flex",padding:"16px"}},l.a.createElement("div",{style:{width:"200px",height:"100vh"}},l.a.createElement(d,null)),l.a.createElement("div",{style:{height:"100vh",width:"100%",padding:"0 8px"}},l.a.createElement(o.b,null,l.a.createElement(ie,{path:"/"}),l.a.createElement(w,{path:"/space"}),l.a.createElement($,{path:"/tag/:space_id"}),l.a.createElement(ne,{path:"/group/:space_id/:tag_id"})))))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[178,1,2]]]);
//# sourceMappingURL=main.319b967f.chunk.js.map